slot = {}

slot[1] = {
[1] = createObject ( 2324, 1964.5856933594 ,998.53344726563 ,992.96502685547 ,0 ,0 ,257.24487304688),
[2] = createObject ( 2324, 1964.56640625 ,998.4501953125 ,992.96502685547 ,0 ,0 ,257.24487304688),
[3] = createObject ( 2324, 1964.548828125 ,998.36608886719 ,992.96502685547 ,0 ,0 ,257.24487304688),
["Marker"] = createMarker ( 1963.6403808594 ,998.6240234375 ,991.4677734375, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 1963.84765625,
["Kameray"] = 998.69006347656,
["KameraZ"] = 993.54998779297,
["Int"] = 10,
}

slot[2] = {
[1] = createObject ( 2324, 1965.0568847656 ,998.21618652344 ,993.02709960938 ,10 ,0 ,80),
[2] = createObject ( 2324, 1965.0751953125 ,998.32049560547 ,993.02709960938 ,10 ,0 ,80),
[3] = createObject ( 2324, 1965.0908203125 ,998.41271972656 ,993.02703857422 ,10 ,0 ,80),
["Marker"] = createMarker (1966.3140869141 ,998.13726806641 ,991.46875, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 1965.8868408203,
["Kameray"] = 998.13165283203,
["KameraZ"] = 993.54998779297,
["Int"] = 10,
}

slot[3] = {
[1] = createObject ( 2324, 1964.5390625 ,1037.3728027344 ,993.01403808594 ,0 ,0 ,281.75),
[2] = createObject ( 2324, 1964.5589599609 ,1037.2749023438 ,993.01403808594 ,0 ,0 ,281.74987792969),
[3] = createObject ( 2324, 1964.5830078125 ,1037.177734375 ,993.01403808594 ,0 ,0 ,281.74987792969),
["Marker"] = createMarker ( 1963.5222167969 ,1037.0356445313 ,991.47448730469, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 1963.7889404297,
["Kameray"] = 1037.2154541016,
["KameraZ"] = 993.55010986328,
["Int"] = 10,
}

slot[4] = {
[1] = createObject ( 2324, 1965.1169433594 ,1037.2593994141 ,993.00933837891 ,10 ,0 ,102),
[2] = createObject ( 2324, 1965.0947265625 ,1037.3564453125 ,993.00933837891 ,10 ,0 ,102),
[3] = createObject ( 2324, 1965.072265625 ,1037.4521484375 ,993.00933837891 ,10 ,0 ,102),
["Marker"] = createMarker ( 1966.029296875 ,1037.5712890625 ,991.46875, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 1965.7868652344,
["Kameray"] = 1037.5517578125,
["KameraZ"] = 993.54998779297,
["Int"] = 10,
}

slot[5] = {
[1] = createObject ( 2324, 2269.28125 ,1606.7744140625 ,1006.769397461 ,0 ,0 ,271.99951171875),
[2] = createObject ( 2324, 2269.283203125 ,1606.6748046875 ,1006.769397461 ,0 ,0 ,271.99951171875),
[3] = createObject ( 2324, 2269.28515625 ,1606.57421875 ,1006.769397461 ,0 ,0 ,271.99951171875), 
["Marker"] = createMarker ( 2268.4357910156 ,1606.6668701172 ,1006.769397461, "cylinder", 1, 255, 0, 0, 255,getRootElement() ), 
["Kamerax"] = 2268.5263671875,
["Kameray"] = 1606.6666259766,
["KameraZ"] = 1007.3804321289,
["Int"] = 1,
}

slot[6] = {
[1] = createObject ( 2324, 2217.0305175781 ,1604.0109863281 ,1006.768371582 ,0 ,0 ,269),
[2] = createObject ( 2324, 2217.029296875 ,1603.9106445313 ,1006.768371582 ,0 ,0 ,269),
[3] = createObject ( 2324, 2217.0283203125 ,1603.8100585938 ,1006.768371582 ,0 ,0 ,269),
["Marker"] = createMarker ( 2216.0598144531 ,1603.8572998047 ,1005.1041870117, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 2216.2805175781,
["Kameray"] = 1603.9357910156,
["KameraZ"] = 1007.3804321289,
["Int"] = 1,
}

slot[7] = {
[1] = createObject ( 2324, 2217.5173339844 ,1603.8070068359 ,1006.7587890625 ,0 ,0 ,92),
[2] = createObject ( 2324, 2217.5146484375 ,1603.9067382813 ,1006.7587890625 ,0 ,0 ,92),
[3] = createObject ( 2324, 2217.5126953125 ,1604.0063476563 ,1006.7587890625 ,0 ,0 ,92),
["Marker"] = createMarker ( 2218.4145507813 ,1603.8337402344 ,1005.0786132813, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 2218.341796875,
["Kameray"] = 1603.8480224609,
["KameraZ"] = 1007.3804321289,
["Int"] = 1,
}

slot[8] = {
[1] = createObject ( 2324, 2269.7451171875 ,1606.5561523438 ,1006.7462158203 ,0 ,0 ,90),
[2] = createObject ( 2324, 2269.7451171875 ,1606.6557617188 ,1006.7462158203 ,0 ,0 ,90),
[3] = createObject ( 2324, 2269.7451171875 ,1606.7553710938 ,1006.7462158203 ,0 ,0 ,90),
["Marker"] = createMarker ( 2270.7658691406 ,1606.6799316406 ,1005.1286621094, "cylinder", 1, 255, 0, 0, 255,getRootElement() ),
["Kamerax"] = 2270.4340820313,
["Kameray"] = 1606.7504882813,
["KameraZ"] = 1006.968371582,
["Int"] = 1,
}
local slotID = {}

function slotmarkerhit(thePlayer)
	if getLocalPlayer() == thePlayer then
		local Slot = slotID[source]
		if not (Slot == false) then
			if (mymoney >= 25 ) then
				fadecam(Slot)
				enableBinds(Slot)
			else
				addEventHandler ( "onClientRender", getRootElement(), showmoneytext )
				setTimer ( 
					function ()
						removeEventHandler ( "onClientRender", getRootElement(), showmoneytext )
					end,
				4500, 1 )
			end
		end
	end
end


for i, w in ipairs(slot)  do
	setElementInterior(w[1], w["Int"])
	setElementInterior(w[2], w["Int"])
	setElementInterior(w[3], w["Int"])
	setElementInterior(w["Marker"], w["Int"])
	slotID[w["Marker"]] = i
	addEventHandler("onClientMarkerHit", w["Marker"], slotmarkerhit)
end

function showmoneytext()
	dxDrawText("Du hast nicht genug Geld!",4,4,screenwidth+4,screenheight+4,tocolor(0,0,0,255),3,"pricedown","center","center",false,false,true)
	dxDrawText("Du hast nicht genug Geld!",2,2,screenwidth+2,screenheight+2,tocolor(150,0,0,255),3,"pricedown","center","center",false,false,true)
end
function showlosetext()
	dxDrawText("Leider kein Gewinn!",4,4,screenwidth+4,screenheight+4,tocolor(0,0,0,255),3,"pricedown","center","center",false,false,true)
	dxDrawText("Leider kein Gewinn!",2,2,screenwidth+2,screenheight+2,tocolor(150,0,0,255),3,"pricedown","center","center",false,false,true)
end
function showwintext(amount)
	dxDrawText("Du gewinnst "..slotMachineWinAmount.." $!",4,4,screenwidth+4,screenheight+4,tocolor(0,0,0,255),3,"pricedown","center","center",false,false,true)
	dxDrawText("Du gewinnst "..slotMachineWinAmount.." $!",2,2,screenwidth+2,screenheight+2,tocolor(0,150,0,255),3,"pricedown","center","center",false,false,true)
end

function fadecam(Slot)
	local x,y,z = getElementPosition(slot[Slot][2])
	setCameraMatrix(slot[Slot]["Kamerax"], slot[Slot]["Kameray"], slot[Slot]["KameraZ"], x ,y ,z )
	toggleAllControls(false)
end



function moveRolle(SID, xnr,ynr,znr, nr)
	if nr == 1 then
		setTimer(moveObject, 1000, 5, slot[SID][1], 1000,xnr, ynr, znr, 360,0 ,0 )
	elseif nr == 2 then
		setTimer(moveObject, 1000, 4, slot[SID][2], 1000,xnr, ynr, znr, 360,0 ,0 )
	elseif nr == 3 then
		setTimer(moveObject, 1000, 3, slot[SID][3], 1000,xnr, ynr, znr, 360,0 ,0 )
	end
end

function moveBandit(SID)
	local x1,y1,z1 = getElementPosition(slot[SID][1])
		setTimer( moveRolle, 100, 1,
					SID, x1,y1,z1, 1
	)
	local x2,y2,z2 = getElementPosition(slot[SID][2])
		setTimer( moveRolle, 1100, 1,
					SID, x2,y2,z2, 2
	)
	local x3,y3,z3 = getElementPosition(slot[SID][3])
		setTimer( moveRolle, 2100, 1,
					SID, x3,y3,z3, 3
	)
end

moves = {
["Melone"] = 10,
["Traube"] = 28,
["BAR"] = 46,
["Glocke"] = 64,
["Kirsche"] = 80,
["Blaue Sieben"] = 96,
["Rote Sieben"] = 132,
["3x R Bar"] = 46,
}

function setRight(SID, r1, r2, r3)
	local x,y,z = getElementPosition(slot[SID][1])
	local rx,ry,rz = getElementRotation(slot[SID][1])
	local final = 360-rx+moves[tostring(r1)]
	moveObject(slot[SID][1],1000,x,y,z,final,0,0)
	
	local x,y,z = getElementPosition(slot[SID][2])
	local rx,ry,rz = getElementRotation(slot[SID][2])
	local final = 360-rx+moves[r2]
	moveObject(slot[SID][2],2000,x,y,z,final,0,0)
	
	local x,y,z = getElementPosition(slot[SID][3])
	local rx,ry,rz = getElementRotation(slot[SID][3])
	local final = 360-rx+moves[r3]
	moveObject(slot[SID][3],3000,x,y,z,final,0,0)
end

function enableBinds(slot)
	bindKey ("enter", "down", startbandit, slot)
	bindKey ("space", "down", exitbandit)
end

function disableBinds()
	unbindKey("enter", "down", startbandit)
	unbindKey("space", "down", exitbandit)
end

function exitbandit()
	toggleAllControls(true)
	setCameraTarget(getLocalPlayer())
	disableBinds()
end

function startbandit(btn,state,slot)
	triggerServerEvent("Slot", getLocalPlayer(),getLocalPlayer(),slot)
	disableBinds()
end

function textmanager(typ, amount)
	if typ == 1 then
		addEventHandler ( "onClientRender", getRootElement(), showwintext )
		setTimer ( 
			function ()
				removeEventHandler ( "onClientRender", getRootElement(), showwintext )
			end,
		4500, 1 )
	elseif typ == 0 then
		addEventHandler ( "onClientRender", getRootElement(), showlosetext )
		setTimer ( 
			function ()
				removeEventHandler ( "onClientRender", getRootElement(), showlosetext )
			end,
		4500, 1 )
	end
	setTimer(exitbandit,2000,1)
end

function onWin(SID,winAmount,symbol)
	setTimer(moveBandit,100,1, SID)
	setTimer(setRight,6300,1,SID,symbol,symbol,symbol)
	setTimer(textmanager,9300,1,1)
	slotMachineWinAmount = winAmount
end
addEvent("onBanditWin", true)
addEventHandler("onBanditWin", getRootElement(), onWin)

function onLose(SID,symbol1,symbol2,symbol3)
	setTimer(moveBandit,100,1, SID)
	setTimer(setRight,6300,1,SID,symbol1,symbol2,symbol3)
	setTimer(textmanager,9300,1,0)
end
addEvent("onBanditLose", true)
addEventHandler("onBanditLose", getRootElement(), onLose)
